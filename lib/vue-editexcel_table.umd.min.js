(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["vue-editexcel_table"]=t():e["vue-editexcel_table"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function i(s){if(t[s])return t[s].exports;var a=t[s]={i:s,l:!1,exports:{}};return e[s].call(a.exports,a,a.exports,i),a.l=!0,a.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(s,a,function(t){return e[t]}.bind(null,a));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s="fb15")}({"1aa9":function(e,t,i){"use strict";var s=i("788b"),a=i.n(s);a.a},"351a":function(e,t,i){},"5ad6":function(e,t,i){"use strict";var s=i("d428"),a=i.n(s);a.a},"788b":function(e,t,i){},"9bc9":function(e,t,i){},a678:function(e,t,i){"use strict";var s=i("9bc9"),a=i.n(s);a.a},cb5f:function(e,t,i){"use strict";var s=i("351a"),a=i.n(s);a.a},d428:function(e,t,i){},f6fd:function(e,t){(function(e){var t="currentScript",i=e.getElementsByTagName("script");t in e||Object.defineProperty(e,t,{get:function(){try{throw new Error}catch(s){var e,t=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(s.stack)||[!1])[1];for(e in i)if(i[e].src==t||"interactive"==i[e].readyState)return i[e];return null}}})})(document)},fb15:function(e,t,i){"use strict";var s;(i.r(t),"undefined"!==typeof window)&&(i("f6fd"),(s=window.document.currentScript)&&(s=s.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(i.p=s[1]));var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"po-r"},[e.showTotal?i("div",{staticClass:"total-row mb-10"},[i("div",{staticClass:"text-bold"},[e._v("数据统计：")]),i("div",{staticClass:"color-light"},[e._v("工作项目（"),i("span",{staticClass:"color-primary"},[e._v(e._s(e.projectNum)+"个")]),e._v("）")]),i("div",{staticClass:"color-light ml-10"},[e._v("工作任务：（"),i("span",{staticClass:"color-primary"},[e._v(e._s(e.taskNum)+"个")]),e._v("）")]),i("div",{staticClass:"color-light ml-10"},[e._v("职业能力：（"),i("span",{staticClass:"color-primary"},[e._v(e._s(e.abilityNum)+"个")]),e._v("）")])]):e._e(),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isEdit||e.tableData.length>0,expression:"isEdit||tableData.length>0"}],staticClass:"flex-table"},[i("div",{staticClass:"table-header"},[e._m(0),i("div",{staticClass:"header-children"},[e._m(1),i("div",{staticClass:"header-ability"},[e._m(2),e.showRequire?i("div",{staticClass:"header-level"},[i("div",{staticClass:"level-title"},[e._v("能力要求")]),e._m(3)]):e._e(),e.showLevel?i("div",{staticClass:"header-level"},[i("div",{staticClass:"level-title"},[e._v("学习水平")]),e._m(4)]):e._e()])])]),i("div",{staticClass:"flexBox"},[e._l(e.tableData,(function(t,s){return[!e.onlyShowChecked||t.CheckStatus?i("div",{key:s,staticClass:"flexRow borProj",class:[e.taskAbility[t.Id]?"black":"white"],on:{contextmenu:function(i){return i.preventDefault(),i.stopPropagation(),e.rightClick(i,t)}}},[i("div",{staticClass:"itemCode object-area",style:e.staticNum[t.Id]&&{color:e.returnColor(e.staticNum[t.Id])},attrs:{"data-obj":e.toJson(t)},on:{mousedown:function(i){return e.beforeDown(t,i)}}},[i("div",{staticClass:"taskText just-c"},[e.tier>=1&&t.Id?i("i",{staticClass:"fa check-icon",class:e._f("statusFilter")(t.CheckStatus),on:{click:function(){e.checkBox(t)}}}):e._e(),t.Id||e.isEdit?i("span",[e._v(e._s(e.isEdit?e.isAddZero(s+1):t.Code||e.isAddZero(s+1))+" ")]):e._e()])]),i("div",{staticClass:"itemName object-area",class:e.isEdit&&"no-padding",style:e.staticNum[t.Id]&&{color:e.returnColor(e.staticNum[t.Id])},attrs:{"data-obj":e.toJson(t)},on:{mousedown:function(i){return e.beforeDown(t,i)}}},[t.focus?i("div",{staticClass:"input-box"},[i("el-input",{staticClass:"text-input mlr-5",attrs:{type:"textarea",autosize:"",resize:"none","data-focus":t.focus,readonly:!e.isEdit},on:{input:function(i){return e.changeStatus(t)},change:function(i){return e.updateAdd(t,i)}},nativeOn:{keydown:function(i){return!i.type.indexOf("key")&&e._k(i.keyCode,"enter",13,i.key,"Enter")?null:(i.preventDefault(),e.updateAdd(t,i))}},model:{value:t.Name,callback:function(i){e.$set(t,"Name",i)},expression:"project.Name"}})],1):i("div",{staticClass:"projText just-c"},[e._v(e._s(t.Name))])]),i("div",{staticClass:"itemChildren"},[e._l(t.Children,(function(a,n){return[!e.onlyShowChecked||a.CheckStatus?i("div",{key:n,staticClass:"flexRow",class:[n==t.Children.length-1?"borItemL":"borItem",e.taskAbility[a.Id]?"black":"white"],on:{contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.rightClick(t,a)}}},[i("div",{staticClass:"itemCode object-area",style:e.staticNum[a.Id]&&{color:e.returnColor(e.staticNum[a.Id])},attrs:{"data-obj":e.toJson(a)},on:{mousedown:function(t){return t.stopPropagation(),e.beforeDown(a,t)}}},[i("div",{staticClass:"taskText just-c"},[e.tier>=2&&a.Id?i("i",{staticClass:"fa check-icon",class:e._f("statusFilter")(a.CheckStatus),on:{click:function(){e.checkBox(a,t)}}}):e._e(),a.Id||e.isEdit?i("span",[e._v(" "+e._s(e.isEdit?e.isAddZero(s+1)+"-"+e.isAddZero(n+1):a.Code||e.isAddZero(s+1)+"-"+e.isAddZero(n+1))+" ")]):e._e()])]),i("div",{staticClass:"itemName object-area",class:e.isEdit&&"no-padding",style:e.staticNum[a.Id]&&{color:e.returnColor(e.staticNum[a.Id])},attrs:{"data-obj":e.toJson(a)},on:{mousedown:function(t){return t.stopPropagation(),e.beforeDown(a,t)}}},[a.focus?i("div",{staticClass:"input-box"},[i("el-input",{staticClass:"text-input mlr-5",attrs:{type:"textarea",autosize:"",resize:"none",readonly:!e.isEdit,"data-focus":a.focus},on:{input:function(t){return e.changeStatus(a)},change:function(t){return e.updateAdd(a,t)}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.updateAdd(a,t))}},model:{value:a.Name,callback:function(t){e.$set(a,"Name",t)},expression:"task.Name"}})],1):i("div",{staticClass:"taskText just-c"},[e._v(e._s(a.Name))])]),i("div",{staticClass:"itemChildren"},[e._l(a.Children,(function(l,r){return[!e.onlyShowChecked||l.CheckStatus?i("div",{key:r,staticClass:"flexRow",class:[r==a.Children.length-1?"borItemL":"borItem",e.taskAbility[l.Id]?"black":"white"],style:e.staticNum[l.Id]&&{color:e.returnColor(e.staticNum[l.Id])},on:{contextmenu:function(t){return t.preventDefault(),t.stopPropagation(),e.rightClick(t,l)}}},[i("div",{staticClass:"itemCodeA object-area",attrs:{"data-obj":e.toJson(l)},on:{mousedown:function(t){return t.stopPropagation(),e.beforeDown(l,t)}}},[i("div",{staticClass:"abilText just-c"},[e.tier>=3&&l.Id?i("i",{staticClass:"fa check-icon",class:e._f("statusFilter")(l.CheckStatus),on:{click:function(){e.checkBox(l,a,t)}}}):e._e(),l.Id||e.isEdit?i("span",[e._v(" "+e._s(e.isEdit?e.isAddZero(s+1)+"-"+e.isAddZero(n+1)+"-"+e.isAddZero(r+1):l.Code||e.isAddZero(s+1)+"-"+e.isAddZero(n+1)+"-"+e.isAddZero(r+1))+" ")]):e._e()])]),i("div",{staticClass:"itemNameA object-area",class:e.isEdit&&"no-padding",attrs:{"data-obj":e.toJson(l)},on:{mousedown:function(t){return t.stopPropagation(),e.beforeDown(l,t)}}},[l.focus?i("div",{staticClass:"input-box"},[i("el-input",{staticClass:"text-input ability-input",attrs:{type:"textarea",autosize:"",resize:"none",readonly:!e.isEdit,"data-focus":l.focus},on:{change:function(t){return e.updateAdd(l,t)},input:function(t){return e.changeStatus(l)}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.updateAdd(l,t))}},model:{value:l.Name,callback:function(t){e.$set(l,"Name",t)},expression:"ability.Name"}})],1):i("div",{staticClass:"abilText"},[e._v(e._s(l.Name))])]),e.showRequire?i("div",{staticClass:"level-box"},[i("div",{staticClass:"item-level"},[i("div",{staticClass:"abilText radio"},[i("el-radio",{attrs:{label:"1",disabled:!e.isEdit},on:{change:function(t,i){e.changeStatus(l),e.updateAdd(l,i,t)}},model:{value:l.Demand,callback:function(t){e.$set(l,"Demand",t)},expression:"ability.Demand"}})],1)]),i("div",{staticClass:"item-level"},[i("div",{staticClass:"abilText radio"},[i("el-radio",{attrs:{label:"0",disabled:!e.isEdit},on:{change:function(t,i){e.changeStatus(l),e.updateAdd(l,i,t)}},model:{value:l.Demand,callback:function(t){e.$set(l,"Demand",t)},expression:"ability.Demand"}})],1)])]):e._e(),e.showLevel?i("div",{staticClass:"level-box"},[i("div",{staticClass:"item-level",on:{click:function(t){return t.stopPropagation(),e.domClick(l,t)}}},[l.focus?i("div",{staticClass:"input-box"},[i("el-input",{staticClass:"text-input ability-input",attrs:{type:"textarea",autosize:"",resize:"none",readonly:!e.isEdit},on:{change:function(t){return e.updateAdd(l,t)},input:function(t){return e.changeStatus(l)}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.updateAdd(l,t))}},model:{value:l.Li,callback:function(t){e.$set(l,"Li",t)},expression:"ability.Li"}})],1):i("div",{staticClass:"abilText"},[e._v(e._s(l.Li))])]),i("div",{staticClass:"item-level",on:{click:function(t){return t.stopPropagation(),e.domClick(l,t)}}},[l.focus?i("div",{staticClass:"input-box"},[i("el-input",{staticClass:"text-input ability-input",attrs:{type:"textarea",autosize:"",resize:"none",readonly:!e.isEdit},on:{change:function(t){return e.updateAdd(l,t)},input:function(t){return e.changeStatus(l)}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.updateAdd(l,t))}},model:{value:l.Lj,callback:function(t){e.$set(l,"Lj",t)},expression:"ability.Lj"}})],1):i("div",{staticClass:"abilText"},[e._v(e._s(l.Lj))])]),i("div",{staticClass:"item-level",on:{click:function(t){return t.stopPropagation(),e.domClick(l,t)}}},[l.focus?i("div",{staticClass:"input-box"},[i("el-input",{staticClass:"text-input ability-input",attrs:{type:"textarea",autosize:"",resize:"none",readonly:!e.isEdit},on:{change:function(t){return e.updateAdd(l,t)},input:function(t){return e.changeStatus(l)}},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.updateAdd(l,t))}},model:{value:l.Lk,callback:function(t){e.$set(l,"Lk",t)},expression:"ability.Lk"}})],1):i("div",{staticClass:"abilText"},[e._v(e._s(l.Lk))])])]):e._e()]):e._e()]}))],2)]):e._e()]}))],2)]):e._e()]}))],2),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showMenu,expression:"showMenu"}],ref:"fixedMenu",staticClass:"fixed-menu",attrs:{id:"fixedMenu"}},[i("ul",[i("li",{on:{click:e.topMove}},[e._v("向上移一行")]),i("li",{on:{click:e.bottomMove}},[e._v("向下移一行")]),i("hr"),i("li",{on:{click:function(t){return e.topAdd()}}},[e._v("在上方插入一行")]),i("li",{on:{click:function(t){return e.bottomAdd()}}},[e._v("在下方插入一行")]),i("hr"),i("li",{on:{click:function(t){return e.copyItem()}}},[e._v("复制")]),i("li",{on:{click:function(t){return e.pasteItem()}}},[e._v("粘贴")]),i("hr"),e.canDelete?i("li",{staticClass:"delete",on:{click:e.beforeDeleteCurent}},[e._v("删除所在行和子集")]):e._e()])])]),i("div",{directives:[{name:"show",rawName:"v-show",value:!e.isEdit&&0==e.tableData.length,expression:"!isEdit&&tableData.length==0"}],staticClass:"text-c ptb-60"},[i("img",{attrs:{src:"/img/暂无内容.png",alt:""}})]),i("BackTop"),i("div",{attrs:{id:"drag-icon"}})],1)},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"header-project"},[i("div",{staticClass:"itme-title"},[e._v("工作项目")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"header-task"},[i("div",{staticClass:"itme-title"},[e._v("工作任务")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"ability-title"},[i("div",{staticClass:"itme-title"},[e._v("职业能力（技能、工具、方法、要求、知识）")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"level-box"},[i("div",[e._v("高")]),i("div",[e._v("中")])])},function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"level-box"},[i("div",[e._v("中职")]),i("div",[e._v("高职")]),i("div",[e._v("本科")])])}],l=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.showBtn,expression:"showBtn"}],staticClass:"back-top",on:{click:e.backTop}},[i("i",{staticClass:"fa fa-chevron-up"})])},r=[],o={components:{},data(){return{timer:null,autoScroll:!0,showBtn:!1}},mounted(){window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop;this.showBtn=e>0,this.autoScroll||clearInterval(this.timer),this.autoScroll=!1}},methods:{backTop(){this.timer=setInterval(()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=Math.floor(-e/8);0===e&&clearInterval(this.timer),this.autoScroll=!0,document.documentElement.scrollTop=document.body.scrollTop=e+t},30)}}},d=o;i("a678");function c(e,t,i,s,a,n,l,r){var o,d="function"===typeof e?e.options:e;if(t&&(d.render=t,d.staticRenderFns=i,d._compiled=!0),s&&(d.functional=!0),n&&(d._scopeId="data-v-"+n),l?(o=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},d._ssrRegister=o):a&&(o=r?function(){a.call(this,this.$root.$options.shadowRoot)}:a),o)if(d.functional){d._injectStyles=o;var c=d.render;d.render=function(e,t){return o.call(t),c(e,t)}}else{var h=d.beforeCreate;d.beforeCreate=h?[].concat(h,o):[o]}return{exports:e,options:d}}var h=c(d,l,r,!1,null,"ce714864",null),u=h.exports,f={name:"EditTable",components:{BackTop:u},filters:{statusFilter(e){const t={0:"fa-square-o",1:"fa-check-square",2:"fa-minus-square"};return t[e]}},props:{tier:{type:Number,default:0},defaultKeys:{type:Array,default:()=>[]},abilityTree:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!1},baseParams:{type:Object,default:()=>({})},addRequest:{type:Object,default:()=>({})},editRequest:{type:Object,default:()=>({})},deleteRequest:{type:Object,default:()=>({})},moveRequest:{type:Object,default:()=>({})},taskAbility:{type:Object,default:()=>({})},dragRequest:{type:Object,default:()=>({url:"/VocationalAbility/Move"})},showRequire:{type:Boolean,default:!1},showLevel:{type:Boolean,default:!1},catlogId:{type:String,default:"481f7e6e-374d-4002-8123-14064d75f69c"},abilityId:{type:String,default:"d895143f-c7b6-466e-b241-1b56fb3a79b8"},showTotal:{type:Boolean,default:!1},onlyShowChecked:{type:Boolean,default:!1},checkedTree:{type:Object,default:()=>({})},limitNum:{type:Number,default:3},canDelete:{type:Boolean,default:!0}},data(){return{abilityCatelog:[],tableData:[],showMenu:!1,handleObj:{},cloneData:{CheckStatus:0,Checked:!1,IsChanged:!1,focus:0,Code:"",Id:"",Name:"",ParentId:null,SelectCount:null,Type:"Project",Children:[{CheckStatus:0,Checked:!1,IsChanged:!1,focus:0,Code:"",Id:"",Name:"",ParentId:"",SelectCount:null,Type:"Task",Children:[{CheckStatus:0,Checked:!1,Children:[],focus:0,Code:"",Id:"",Sort:0,Name:"",ParentId:"",SelectCount:null,Type:"Ability",IsChanged:!1,Demand:"1"}]}]},projectNum:0,taskNum:0,abilityNum:0,currentObj:{},stopUpdate:!1,loading:!1,staticNum:{},numColor:["#333","#4971F1","#FF3300"],copyData:""}},watch:{abilityTree(e){this.addIndex()},defaultKeys(e){this.addIndex(),this.addDefaultKey()},isEdit(e){this.addIndex()},checkedTree(e){"{}"===JSON.stringify(this.checkedTree)?this.staticNum={}:this.staticNum=e}},mounted(){this.addIndex(),this.addDefaultKey(),document.addEventListener("click",()=>{this.showMenu=!1}),this.$refs.fixedMenu.addEventListener("click",e=>{e.stopPropagation()})},destroyed(){window.removeEventListener("click",()=>{this.showMenu=!1}),window.removeEventListener("scroll",()=>{this.showMenu=!1})},methods:{async getTree(e){const t=await this.$http.get("/VocationalAbility/GetAbilityTree",{params:e});t.Result.Status?this.$message({message:"登录异常，请重试！",type:"error",duration:3e3}):this.abilityCatelog=t.Result.Children},isAddZero(e){return e<10?"0"+e:e},toJson(e){return JSON.stringify(e)},copyItem(){this.showMenu=!1,this.copyData=this.handleObj.Name},pasteItem(){this.showMenu=!1,this.handleObj.Name=this.copyData,this.handleObj.IsChanged=!0,this.updateAdd(this.handleObj)},dragFun(e,t){const i=(new Date).getTime();var s=document.getElementById("drag-icon");let a=null;return a=setTimeout(()=>{s.style.display="block"},500),document.onmousemove=function(e){this.$el.classList.add("none-select"),s.style.display="block";const{left:t,top:i}=this.$el.getBoundingClientRect();var a=e||event,n=a.clientX-t,l=a.clientY-i;n<0?n=0:n>this.$el.offsetWidth-s.offsetWidth&&(n=this.$el.offsetWidth-s.offsetWidth),l<0?l=0:l>this.$el.offsetHeight-s.offsetHeight&&(l=this.$el.offsetHeight-s.offsetHeight),s.style.left=n+"px",s.style.top=l+"px"}.bind(this),document.onmouseup=async t=>{const n=(new Date).getTime();if(n-i<500)return document.onmousemove=null,document.onmouseup=null,clearTimeout(a),s.style.display="none",void this.$el.classList.remove("none-select");clearTimeout(a),s.style.display="none",this.$el.classList.remove("none-select"),document.onmousemove=null,document.onmouseup=null;var l=t||event,r=l.clientX,o=l.clientY;if(!e.Id)return void this.$message({showClose:!0,message:"当前操作项目为留空项目，不可操作！",type:"warning",duration:2e3});const d=Array.prototype.slice.call(document.querySelectorAll(".object-area")),c=d.find(e=>{const{left:t,top:i}=e.getBoundingClientRect(),s=e.offsetWidth,a=e.offsetHeight;return r>=t&&r<=t+s&&o>=i&&o<=i+a});if(c){const t=JSON.parse(c.dataset.obj);if(c.dataset.obj===JSON.stringify(e))return;if(!t.ParentId&&"Project"!==t.Type)return void this.$message({showClose:!0,message:"当前操作项目为留空项目，不可操作！",type:"warning",duration:2e3});if(t.Type!==e.Type)return void this.$message({showClose:!0,message:"只能同级之间移动！",type:"warning",duration:2e3});let i=[];const s=e.numIndex;i=e.ParentId?this.findObj(e.ParentId,this.tableData).Children:this.tableData,console.log(i,s),i.splice(s,1),this.handleObj=t,this.topAdd(JSON.parse(JSON.stringify(e))),console.log("删除后还有么",this.tableData);const a=this.findObj(e.Id,this.tableData),n=this.findObj(a.ParentId,this.tableData);a.IsChanged=!0,console.log("结果对象",a,n),this.moveItem(a)}else console.log("位置不对")},!1},async moveItem(e,t,i){if("Project"!==e.Type&&!e.ParentId)return void this.$message({type:"error",message:"该项父级为空，请先添加父级再进行此操作！"});if(this.loading)return;if(this.loading=!0,this.handleObj=e,!e.IsChanged)return console.log("hello你好，你没改内容"),void(this.loading=!1);if(!e.Name)return this.$message({type:"error",message:"内容不能为空！"}),void(this.loading=!1);let s=this.getParams(e,i);this.baseParams&&(s={...s,...this.baseParams});try{let t=null;if(t=await this.$http.post(this.dragRequest.url,{...s,...this.dragRequest.params}),!t.Result)throw new Error("123");this.addNumIndex(this.tableData),e.IsChanged=!1}catch(a){console.log(a),this.$message({type:"error",message:"操作失败，请重试！"})}finally{this.loading=!1}},returnColor(e){return e<3?this.numColor[e-1]:this.numColor[2]},setSelectNum(e,t,i){e.forEach(e=>{i[e.Id]=t,e.Children&&e.Children.length>0&&this.setSelectNum(e.Children,t,i)})},domClick(e,t){this.isEdit&&(this.currentObj.Code===e.Code&&this.currentObj.ParentId===e.ParentId||(this.currentObj.focus=0),this.currentObj=e,e.focus=1,this.$nextTick(()=>{if("el-textarea__inner"===t.target.className)t.target.focus();else if(t.target.getElementsByClassName("el-textarea__inner").length){const e=t.target.getElementsByClassName("el-textarea__inner");e[0].focus()}}))},beforeDown(e,t){this.isEdit&&(this.currentObj.Code===e.Code&&this.currentObj.ParentId===e.ParentId||(this.currentObj.focus=0),this.currentObj=e,e.focus=1,this.$nextTick(()=>{if("el-textarea__inner"===t.target.className)t.target.focus();else if(t.target.getElementsByClassName("el-textarea__inner").length){const e=t.target.getElementsByClassName("el-textarea__inner");e[0].focus()}}),this.dragFun(e))},handleRadio(e,t){t.Demand=e},keyListen(e,t){return t.preventDefault(),!1},async updateAdd(e,t,i){if("Project"!==e.Type&&!e.ParentId)return void this.$message({type:"error",message:"该项父级为空，请先添加父级再进行此操作！"});if(this.loading)return;this.loading=!0,this.handleObj=e;const{arr:s,index:a}=this.strikeHandle();if(!e.IsChanged)return console.log("hello你好，你没改内容"),void(this.loading=!1);if(!e.Name)return this.$message({type:"error",message:"内容不能为空！"}),void(this.loading=!1);let n=this.getParams(e,i);this.baseParams&&(n={...n,...this.baseParams});try{let i=null;if(i=n.Id?await this.$http.post(this.editRequest.url,{...n,...this.editRequest.params}):await this.$http.post(this.addRequest.url,{...n,...this.addRequest.params}),!i.Result)throw new Error("123");n.Id||(e.Id=i.Result,e.Children.forEach(t=>{t.ParentId=e.Id}),console.log("修改后的对象",e),this.addNumIndex(this.tableData),t&&t.keyCode&&(s[a+1].focus=1,this.$nextTick(()=>{const e=Array.prototype.slice.call(document.querySelectorAll(".el-textarea__inner")),t=e.find(e=>1===e.dataset.focus);t&&t.focus()}))),e.IsChanged=!1}catch(l){console.log(l),this.$message({type:"error",message:"操作失败，请重试！"})}finally{this.loading=!1}},getParams(e,t){let i={};return"Ability"===e.Type?(i={Sort:e.numIndex+1,Name:e.Name,AbilityCatelog:e.ParentId,Id:e.Id,TableId:this.abilityId,Li:e.Li,Lj:e.Lj,Lk:e.Lk,Demand:e.Demand},t&&(i.Demand=t)):i={Sort:e.numIndex+1,Name:e.Name,Parent:e.ParentId,Id:e.Id,TableId:this.catlogId},Object.assign(i,this.baseParams)},getEdit(){this.tableData.forEach((e,t)=>{let i={};i=e.IsChanged?e:{},e.Children&&e.Children.forEach((e,t)=>{"{}"===JSON.stringify(i)?i=e.IsChanged?e:{}:i.Children=e.IsChanged?e:{},e.Children&&e.Children.forEach((e,t)=>{})})})},changeStatus(e){e.IsChanged=!0},beforeDeleteCurent(e){this.showMenu=!1,this.$confirm("此操作将会删除所有已勾选该项的记录, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.deleteCurent()}).catch(()=>{this.$message({type:"info",message:"已取消删除"})})},async deleteCurent(){console.log(this.handleObj);const{arr:e,index:t}=this.strikeHandle();if(!this.handleObj.Id&&t===e.length-1)return void this.$message({type:"warning",message:"当前项为空数据，无法删除！"});this.showMenu=!1;let i={};i="Ability"===this.handleObj.Type?{TableId:this.abilityId,Id:this.handleObj.Id}:{TableId:this.catlogId,Id:this.handleObj.Id};try{this.handleObj.Id&&await this.$http.get(this.deleteRequest.url,{params:{...i,...this.deleteRequest.params}}),e.splice(t,1),this.addNumIndex(this.tableData)}catch(s){this.$message({type:"error",message:"操作失败，请重试！"})}},topAdd(e){if("Project"===this.handleObj.Type||this.handleObj.ParentId){var{arr:t,index:i}=this.strikeHandle();if(this.showMenu=!1,e){const t=JSON.parse(JSON.stringify(e));this.handleObj.ParentId===t.ParentId&&i>=t.Sort&&(i-=1),console.log("条件",this.handleObj.ParentId===t.ParentId,i,t.Sort)}if("Project"===this.handleObj.Type){const s=e||JSON.parse(JSON.stringify(this.cloneData));t.splice(i,0,s)}else if("Ability"===this.handleObj.Type){const s=e||JSON.parse(JSON.stringify(this.cloneData.Children[0].Children[0]));s.ParentId=this.handleObj.ParentId,t.splice(i,0,s)}else{const s=e||JSON.parse(JSON.stringify(this.cloneData.Children[0]));s.ParentId=this.handleObj.ParentId,t.splice(i,0,s)}this.addNumIndex(this.tableData)}else this.$message({type:"warning",message:"此项还没有父级，无法添加！"})},bottomAdd(e){if("Project"!==this.handleObj.Type&&!this.handleObj.ParentId)return void this.$message({type:"warning",message:"此项还没有父级，无法添加！"});const{arr:t,index:i}=this.strikeHandle();if(this.showMenu=!1,"Project"===this.handleObj.Type){const s=e||JSON.parse(JSON.stringify(this.cloneData));t.splice(i+1,0,s)}else if("Ability"===this.handleObj.Type){const s=e||JSON.parse(JSON.stringify(this.cloneData.Children[0].Children[0]));s.ParentId=this.handleObj.ParentId,t.splice(i+1,0,s)}else{const s=e||JSON.parse(JSON.stringify(this.cloneData.Children[0]));s.ParentId=this.handleObj.ParentId,t.splice(i+1,0,s)}this.addNumIndex(this.tableData)},async topMove(){const{arr:e,index:t}=this.strikeHandle();if(this.showMenu=!1,this.handleObj.Id)if(0!==t){let i={};i="Ability"===this.handleObj.Type?{TableId:this.abilityId,aId:this.handleObj.Id,bId:e[t-1].Id}:{TableId:this.catlogId,aId:this.handleObj.Id,bId:e[t-1].Id};const s=await this.$http.get(this.moveRequest.url,{params:{...i,...this.moveRequest.params}});s.Result?(this.swapArray(e,t,t-1),this.addNumIndex(this.tableData)):this.$message({type:"error",message:"操作失败，请重试"})}else this.$message({type:"warning",message:"已经处于第一个，无法上移"});else this.$message({type:"warning",message:"该项数据为空，请保存后操作！"})},strikeHandle(){let e=[];return e=this.handleObj.ParentId?this.findObj(this.handleObj.ParentId,this.tableData).Children:this.tableData,{arr:e,index:this.handleObj.numIndex}},async bottomMove(){const{arr:e,index:t}=this.strikeHandle();if(this.showMenu=!1,this.handleObj.Id)if(e[t+1].Id)if(t+1!==e.length){let i={};i="Ability"===this.handleObj.Type?{TableId:this.abilityId,aId:this.handleObj.Id,bId:e[t+1].Id}:{TableId:this.catlogId,aId:this.handleObj.Id,bId:e[t+1].Id};const s=await this.$http.get(this.moveRequest.url,{params:{...i,...this.moveRequest.params}});s.Result?(this.swapArray(e,t,t+1),this.addNumIndex(this.tableData)):this.$message({type:"warning",message:"操作失败，请重试"})}else this.$message({type:"warning",message:"已经处于最后一个，无法下移"});else this.$message({type:"warning",message:"已经处于最后一个，无法下移！"});else this.$message({type:"warning",message:"该项数据为空，请保存后操作！"})},swapArray(e,t,i){return e[t]=e.splice(i,1,e[t])[0],e},cloneObj(e){const t={};for(const i in e)"Type"===i?t[i]=e[i]:"Children"===i?(console.log(e[i].length),e[i]&&e[i].length>0?t[i]=[this.cloneObj(e[i][0])]:t[i]=[]):t[i]="";return t},rightClick(e,t){if(!this.isEdit)return;const i=document.documentElement.clientHeight||document.body.clientHeight;i<=e.clientY+260+60?(this.$refs.fixedMenu.style.bottom="60px",this.$refs.fixedMenu.style.top="auto"):this.$refs.fixedMenu.style.top=e.clientY+"px",this.$refs.fixedMenu.style.left=e.clientX+"px",this.handleObj=t,this.showMenu=!0},addIndex(){const e=JSON.parse(JSON.stringify(this.abilityTree));this.addNumIndex(e),this.tableData=e},addNumIndex(e){if(this.statistics(e),e.length<=0&&this.isEdit||e.length&&e[e.length-1].Id&&this.isEdit){const t=JSON.parse(JSON.stringify(this.cloneData));e.push(t)}let t=0;e.forEach((e,i)=>{if(e.numIndex=i,e.Children&&e.Children.length>0){if(e.Children[e.Children.length-1].Id&&this.isEdit){const t=JSON.parse(JSON.stringify(this.cloneData.Children[0]));t.ParentId=e.Id,e.Children.push(t)}e.Children.forEach((e,i)=>{if(e.numIndex=i,++t,e.Index=t,e.Children&&e.Children.length>0){if(e.Children[e.Children.length-1].Id&&this.isEdit){const t=JSON.parse(JSON.stringify(this.cloneData.Children[0].Children[0]));t.ParentId=e.Id,t.numIndex=0,e.Children.push(t)}e.Children.forEach((e,t)=>{e.numIndex=t})}else if(e.Id){const t=JSON.parse(JSON.stringify(this.cloneData.Children[0].Children[0]));t.ParentId=e.Id,t.numIndex=0,e.Children=[t]}})}else{const t=JSON.parse(JSON.stringify(this.cloneData.Children[0]));t.ParentId=e.Id,t.numIndex=0,e.Children=[t]}}),this.addFocus(e)},addFocus(e){e.forEach((e,t)=>{e.focus=0,e.Children&&e.Children.length&&e.Children.forEach(e=>{e.focus=0,e.Children&&e.Children.length&&e.Children.forEach(e=>{e.focus=0})})})},statistics(e){let t=0,i=0,s=0;e.forEach(e=>{e.Id&&t++,e.Children&&e.Children.length>0&&e.Children.forEach(e=>{e.Id&&i++,e.Children&&e.Children.length&&e.Children.forEach(e=>{e.Id&&s++})})}),this.projectNum=t,this.taskNum=i,this.abilityNum=s,this.$emit("update:projectNum",this.projectNum),this.$emit("update:taskNum",this.taskNum),this.$emit("update:abilityNum",this.abilityNum)},editTextArea(){this.$nextTick(()=>{var e=Array.prototype.slice.call(document.querySelectorAll(".el-textarea__inner"),0);e.forEach(e=>{this.makeExpandingArea(e)})})},async intialize(){await this.getTree({params:{schoolId:this.userSid,majorId:this.majorObj.BaseMajorId}}),this.tableData=JSON.parse(JSON.stringify(this.abilityCatelog))},addDefaultKey(){this.defaultKeys&&this.defaultKeys.forEach(e=>{const t=this.findObj(e,this.tableData);let i=null,s=null;t&&t.ParentId&&(i=this.findObj(t.ParentId,this.tableData),i.ParentId&&(s=this.findObj(i.ParentId,this.tableData))),this.selectDefaultKey(t,i,s)})},selectDefaultKey(e,t,i){if(e){if(e.Checked=!0,e.CheckStatus=1,e.Children.length>0&&e.Children.map(t=>{t.Checked=e.Checked,t.CheckStatus=e.CheckStatus,t.Children.length>0&&t.Children.map(t=>{t.CheckStatus=e.CheckStatus,t.Checked=e.Checked})}),t){var s=t.Children.filter(e=>e.Checked).length;0===s?(t.Checked=!1,t.CheckStatus=0):t.Children.length===s?(t.Checked=!0,t.CheckStatus=1):(t.Checked=!1,t.CheckStatus=2)}if(i){var a=i.Children.filter(e=>e.Checked).length,n=i.Children.filter(e=>2===e.CheckStatus).length>0;0!==a||n?i.Children.length===a?(i.Checked=!0,i.CheckStatus=1):(i.Checked=!1,i.CheckStatus=2):(i.Checked=!1,i.CheckStatus=0)}}},findObj(e,t){const i=t.find(t=>t.Id===e);if(i)return i;{let i=null;return t.forEach(t=>{t.Children&&this.findObj(e,t.Children)&&(i=this.findObj(e,t.Children,this.target))}),i}},getProject(){const e=[];return this.tableData.forEach(t=>{t.Checked&&e.push(t.Id)}),e},getTask(){const e=[];return this.tableData.forEach(t=>{t.Children&&t.Children.length>0&&t.Children.forEach(t=>{t.Checked&&e.push(t.Id)})}),e},getVal(){const e=[];return this.tableData.forEach(t=>{t.Children&&t.Children.length>0&&t.Children.forEach(t=>{t.Children&&t.Children.length>0&&t.Children.forEach(t=>{t.Checked&&e.push(t.Id)})})}),e},getFinaly(){const e=[];return this.tableData.forEach(t=>{t.Checked?e.push(t.Id):t.Children&&t.Children.length>0&&t.Children.forEach(t=>{t.Checked?e.push(t.Id):t.Children&&t.Children.length>0&&t.Children.forEach(t=>{t.Checked&&e.push(t.Id)})})}),e},emitChange(){this.$emit("check-change",this.getFinaly())},checkBox(e,t,i){if(this.staticNum[e.Id]&&this.staticNum[e.Id]>=this.limitNum&&!e.Checked&&(console.log(this.staticNum[e.Id]),this.$message({type:"warning",message:"建议最多勾选"+this.limitNum+"次！"})),e.Checked=!e.Checked,e.Checked?this.staticNum[e.Id]=this.staticNum[e.Id]?this.staticNum[e.Id]+=1:1:this.staticNum[e.Id]&&(this.staticNum[e.Id]-=1),e.CheckStatus=e.Checked?1:0,e.Children.length>0&&e.Children.map(t=>{e.Checked&&t.Checked&&this.staticNum[t.Id]&&(this.staticNum[t.Id]-=1),t.Checked=e.Checked,t.CheckStatus=e.CheckStatus,t.Children.length>0&&t.Children.map(i=>{t.Checked&&i.Checked&&this.staticNum[i.Id]&&(this.staticNum[i.Id]-=1),i.CheckStatus=e.CheckStatus,i.Checked=e.Checked})}),t){var s=t.Children.filter(e=>e.Checked).length;0===s?(t.Checked=!1,t.CheckStatus=0):t.Children.length===s?(t.Children.forEach(e=>{this.staticNum[e.Id]&&(this.staticNum[e.Id]-=1)}),t.Checked=!0,t.CheckStatus=1):(t.Checked&&t.Children.forEach(e=>{e.Checked&&(this.staticNum[e.Id]>=3?(this.staticNum[e.Id]+=1,this.$message({message:"有能力已经勾选了三次，将会自动取消勾选！",type:"error"}),this.checkBox(e,t,i)):this.staticNum[e.Id]=this.staticNum[e.Id]?this.staticNum[e.Id]+=1:1)}),t.Checked=!1,t.CheckStatus=2)}if(i){var a=i.Children.filter(e=>e.Checked).length,n=i.Children.filter(e=>2===e.CheckStatus).length>0;0!==a||n?i.Children.length===a?(i.Checked=!0,i.CheckStatus=1):(i.Checked=!1,i.CheckStatus=2):(i.Checked=!1,i.CheckStatus=0)}this.emitChange()},makeExpandingArea(e){var t=null,i=function(e,t){t&&(e.style.height="auto"),e.style.height=e.scrollHeight+"px"},s=function(e){t&&(clearTimeout(t),t=null),t=setTimeout((function(){i(e)}),200)};e.addEventListener?(e.addEventListener("input",(function(){i(e,1)}),!1),i(e)):e.attachEvent&&(e.attachEvent("onpropertychange",(function(){i(e)})),i(e)),window.VBArray&&window.addEventListener&&(e.attachEvent("onkeydown",(function(){var t=window.event.keyCode;8!==t&&46!==t||s(e)})),e.attachEvent("oncut",(function(){s(e)})))}}},m=f,p=(i("1aa9"),i("5ad6"),c(m,a,n,!1,null,"905a615a",null)),C=p.exports;C.install=function(e){e.component(C.name,C)};var b=C,y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{directives:[{name:"show",rawName:"v-show",value:e.showBtn,expression:"showBtn"}],staticClass:"back-top",on:{click:e.backTop}},[i("i",{staticClass:"fa fa-chevron-up"})])},g=[],v={name:"BackTop",components:{},data(){return{timer:null,autoScroll:!0,showBtn:!1}},mounted(){window.onscroll=()=>{var e=document.documentElement.scrollTop||document.body.scrollTop;this.showBtn=e>0,this.autoScroll||clearInterval(this.timer),this.autoScroll=!1}},methods:{backTop(){this.timer=setInterval(()=>{var e=document.documentElement.scrollTop||document.body.scrollTop,t=Math.floor(-e/8);0===e&&clearInterval(this.timer),this.autoScroll=!0,document.documentElement.scrollTop=document.body.scrollTop=e+t},30)}}},k=v,I=(i("cb5f"),c(k,y,g,!1,null,"714e63fc",null)),x=I.exports;x.install=function(e){e.component(x.name,x)};var w=x;const N=[b,w],_=function(e){_.installed||(_.installed=!0,N.map(t=>{e.component(t.name,t)}))};"undefined"!==typeof window&&window.Vue&&_(window.Vue);var j={install:_,EditTable:b,BackTop:w};t["default"]=j}})}));
//# sourceMappingURL=vue-editexcel_table.umd.min.js.map